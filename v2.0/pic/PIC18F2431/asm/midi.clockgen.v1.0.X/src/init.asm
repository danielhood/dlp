; Main entry point

; ------------------------------------------------------------------------------
; MIDI2CV v3.0 Multi-mode midi
;	Both modes respond to all midi channels. Only one channel should be used
;		at at time.
;	A switch on RA0 allows selection of one of two MIDI modes
;	MODE0 (Synth Mode):
;		- PITCH, VEL, and MOD (CC01) on PWM ports (1,3,5)
;		- GATE on RC0 (GATE 1)
;		- CC02 to 05 > 63 on RC1:4 (GATE 2 - 5)
;	MODE1 (Drum Mode):
;		- Respond only to notes C1, C#1, D1, D#1, E1
;		- Gates for each note on RC0:4
;		- Vel for C1, C#1, D1 on PWM1,3,5


#include p18f2431.inc

; ------------------------------------------------------------------------------
; External code refs
;
	extern	_MAIN		; Main App code
	extern	_SERVICE_HI	; Interrupt handlers
	extern	_SERVICE_LO
	extern	_SETUP		; Setup code
	
	global	LFO_SINE_DATA_24
	global	LFO_SINE_DATA_32
	global	LFO_SINE_DATA_96


; ------------------------------------------------------------------------------
; Main entry and RESET vector
;
.RIVEC	org	0x0000
	call	_SETUP		; Init hardware
	goto	_MAIN		; Main app code


; ------------------------------------------------------------------------------
; High-Priority Interrupt Vector
;
.HIVEC	org	0x0008
	goto	_SERVICE_HI	; Points to interrupt service routine


; ------------------------------------------------------------------------------
; Lo-Priority Interrupt Vector
;
.LIVEC	org	0x0018
	goto	_SERVICE_LO	; Points to interrupt service routine


; ------------------------------------------------------------------------------
; Program Data
;

; 24 steps gives us a period over a quareter note, stepped every time we get a TT MIDI message
LFO_SINE_DATA_24:
	db	0x00,0x04,0x11,0x25,0x3f,0x5e,0x7f,0xa0,0xbf,0xd9,0xed,0xfa
	db	0xff,0xfa,0xed,0xd9,0xbf,0xa0,0x7f,0x5e,0x3f,0x25,0x11,0x04

LFO_SINE_DATA_32:
	db	0x00,0x02,0x09,0x15,0x25,0x38,0x4e,0x66,0x7f,0x98,0xb0,0xc6
	db	0xd9,0xe9,0xf5,0xfc,0xff,0xfc,0xf5,0xe9,0xd9,0xc6,0xb0,0x98
	db	0x7f,0x66,0x4e,0x38,0x25,0x15,0x09,0x02

LFO_SINE_DATA_96:
	db	0x00,0x00,0x01,0x02,0x04,0x06,0x09,0x0d,0x11,0x15,0x1a,0x1f
	db	0x25,0x2b,0x31,0x38,0x3f,0x47,0x4e,0x56,0x5e,0x66,0x6e,0x77
	db	0x7f,0x87,0x90,0x98,0xa0,0xa8,0xb0,0xb7,0xbf,0xc6,0xcd,0xd3
	db	0xd9,0xdf,0xe4,0xe9,0xed,0xf1,0xf5,0xf8,0xfa,0xfc,0xfd,0xfe
	db	0xff,0xfe,0xfd,0xfc,0xfa,0xf8,0xf5,0xf1,0xed,0xe9,0xe4,0xdf
	db	0xd9,0xd3,0xcd,0xc6,0xbf,0xb7,0xb0,0xa8,0xa0,0x98,0x90,0x87
	db	0x7f,0x77,0x6e,0x66,0x5e,0x56,0x4e,0x47,0x3f,0x38,0x31,0x2b
	db	0x25,0x1f,0x1a,0x15,0x11,0x0d,0x09,0x06,0x04,0x02,0x01,0x00

	end
